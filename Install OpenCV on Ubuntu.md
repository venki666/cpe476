Install OpenCV on Ubuntu

### 2 ways of installing OpenCV 

Installing from the source
Installing with pip: pip install opencv-python

### Why install OpenCV from source
OpenCV is always under development, and the thing is some parts of the library is not going to published, due to compatibility and copyright issues, but if you use the source then you can have all the capabilities that you need. SURF & SIFT are examples of this problem.

### ROS OpenCV Compatibility 
-   [Ubuntu 16.04 ROS Kinetic](http://wiki.ros.org/kinetic/Installation/Ubuntu) (uses OpenCV 3.3)
-   [Ubuntu 18.04 ROS Melodic](http://wiki.ros.org/melodic/Installation/Ubuntu) (uses OpenCV 3.2)
-   [Ubuntu 20.04 ROS Noetic](http://wiki.ros.org/noetic/Installation/Ubuntu) (uses OpenCV 4.2)


### Short Version 

We leverage [OpenCV](https://opencv.org/) for this project which you can typically use the install from ROS. If these do not work (or are using non-ROS building), then you can try building OpenCV from source ensuring you include the contrib modules. One should make sure you can see some of the "contrib" (e.g. aruco) when you cmake to ensure you have linked to the contrib modules.
```
git clone https://github.com/opencv/opencv/
git clone https://github.com/opencv/opencv\_contrib/
mkdir opencv/build/
cd opencv/build/
cmake -DOPENCV\_EXTRA\_MODULES\_PATH=../../opencv\_contrib/modules ..
make -j8
sudo make install
```
If you do not want to build the modules, you should also be able to do this (while it is not as well tested). The ArucoTag tracker depends on a non-free module in the contrib repository, thus this will need to be disabled. You can disable this with `catkin build -DENABLE_ARUCO_TAGS=OFF` or `cmake -DENABLE_ARUCO_TAGS=OFF ..` in your build folder.

### Long Version

#### Making sure you have all the tools 
This is a complete set up guide for the installation of OpenCV on Ubuntu 18.04 or above. This library supports C++ and python 3.0 and above.

We start by opening our terminal by pressing **Ctrl+Alt+T** from keyboard or manually looking it up through the Application option. We have to make sure that our operating system is updated first.
```
$ sudo apt-get update $ sudo apt-get upgrade
```
Now we need to install tools that will help us install OpenCV on Ubuntu.
```
$ sudo apt-get install build-essential   
$ sudo apt-get install cmake   
$ sudo apt-get install git   
$ sudo apt-get install unzip   
$ sudo apt-get install pkg-config
```
We should also install image tools and video libraries that will help us read images and videos from the local drive.
```
$ sudo apt-get install libjpeg-dev   
$ sudo apt-get install libpng-dev   
$ sudo apt-get install libtiff-dev
```
The `opencv` package consists of core modules mainly, while the `opencv_contrib` consists of the nonfree modules. For an in depth study and usage of opencv, it is important that we also download the `opencv_contrib` package.
```
$ git clone https://github.com/opencv/opencv   
$ git clone [https://github.com/opencv/opencv\_contrib](https://github.com/opencv/opencv_contrib)
```
Check that both the `opencv` and `opencv_contrib` are both of the latest versions otherwise we cannot compile them. If you want a specific version of the library, say version 3.3.4 then do
```
export cvVersion = 3.3.4
cd opencv
git checkout $cvVersion
cd ..

git clone https://github.com/opencv/opencv_contrib.git
cd opencv_contrib
git checkout $cvVersion
cd ..
```
The complation and installation of OpenCV is done using cmake. We should first create a directory to install all the build files generated by the cmake while installing. We should also configure cmake so that it would also install nonfree modules.
```
$ cd ~/opencv   
$ mkdir build   
$ cd build   
$ cmake -D CMAKE\_BUILD\_TYPE=RELEASE \\   
        -D CMAKE\_INSTALL\_PREFIX=/usr/local \\   
        -D WITH\_CUDA=OFF \\   
        -D INSTALL\_PYTHON\_EXAMPLES=ON \\   
        -D OPENCV\_EXTRA\_MODULES\_PATH=~/opencv\_contrib/modules \\   
        -D OPENCV\_ENABLE\_NONFREE=ON \\   
        -D BUILD\_EXAMPLES=ON ..
```
Make sure that you must have mentioned the flag value of `OPENCV_ENABLE_NONFREE=ON`.After the build files have been generated, we used make to install the build files.

This compile of OpenCV takes approximately time 40 mins to 60 mins which depends upon the number of processors you have in your system. We can adjust the speed of the compilation by providing the cores during the process. The alternate command for our compliation that speeds up the process is:

Since we have downloaded this from the source, we need to type the following command to create the necessary links and cache to the most recent shared libraries found in the directories specified.
```
$ sudo ldconfig
```
In order to ensure that the files have been properly installed, we need to check for the **.so** files in our system. For python, we have to navigate to the location below and type the following command:
```
$ cd /usr/local/lib/python3.9/site-packages/cv2/python-3.9 $ ls
```
If the terminal shows a compile file something like this:
```
**cv2.cpython-36m-x86\_64-linux-gnu.so** 
```
Then we can ensure that our opencv has been installed properly for python. For other**.so** files, we can type the following command:
```
$ cd /usr/local/lib $ ls
```
If the terminal shows the list of files like these:
```
**libopencv\_aruco.so.***  
libopencv\_fuzzy.so.***  
libopencv\_core.so.** 
```
The opencv has been installed properly for C++ as well.

Check if the files are installed in `/usr/local/`. In my case my directory is the following:
```
/usr/local/lib/python3.9/site-packages/
```
or 
```
/usr/local/lib/python2.7/site-packages/
```
In `~/.bashrc` add this directory to the Python path
```
export PYTHONPATH=$PYTHONPATH:/usr/local/lib/python3.9/site-packages
```
and 

Add to following lines for 2.7:
```
export PYTHONPATH=/usr/local/lib/python2.7/site-packages:$PYTHONPATH
```
Exit the terminal and open again.
Build the documentation with `make doxygen`.
```
$ cd opencv/build/
$ make doxygen
```
Open the documentation in the browser.
```
$ xdg-open doc/doxygen/html/index.html
```
Go to the directory where you want to start the project.
Create a conda environment:
```
$ conda update conda
$ conda create --name cv
$ conda activate cv
(cv)$
```
Test the install. Open Python. Check the numpy version:
```
>>> import numpy
>>> numpy.__version__
'1.20.1'
```
Check that OpenCV can be imported and version:
```
>>> import cv2 as cv
>>> cv.__version__
'4.5.3-dev'
```
Test these methods to see if OpenCV is working correctly.
Copy an image to your current directory. Letâ€™s say the image is `awesome_image.png`
Import libraries:
```
>>> import numpy as np
>>> import cv2 as cv
```
Read an image:
```
>>> img = cv.imread("awesome_image.png")
>>> cv.namedWindow("Image", cv.WINDOW_NORMAL)
>>> cv.imshow("Image", img)
>>> cv.waitKey(0)
```
Then the image will load. Press `ESC` to get back control of the Terminal.
```
>>> cv.imwrite("output.jpg", img)
True
```
It creates a copy of the file saved as `output.jpg`. The conversion changes the sizes.
```
$ ls -lh
25K awesome_image.png
65K output.jpg
```

### Lets do the built in version for python

Open a terminal (if you do not know how to, you should go back to the page Course computer environment)
Create a directory where we will install some python stuff not to mess up any other things using python or let other things influence this installation for this matter. We will use the python virtualenv for this.
```
cd ~
virtualenv --system-site-packages ~/cvenv
Activate the virtualenv
source ~/cvenv/bin/activate
This should change the prompt in the terminal to be prefixed with (cvenv). Now install some further python packages in this virtualenv
pip install opencv-python
pip install opencv-contrib-python
pip install jupyter 
pip install matplotlib
To deactive the virtualenv you do
deactivate
```
Remember to activate it again when you want to use it.

From now on we will assume that you are standing in the directory ~/learn_cv and that you have activated the cvenv virtualenv. That is we assume that you have done
```
source ~/cvenv/bin/activate
cd ~/learn_cv
```
You will be be using Jupyter notebooks for most of the material here. In a terminal execute the following
```
jupyter notebook cv_learn.ipynb
```
If a browser window does not open up automatically, take a look at the output in the terminal window and guide the browser to the address displayed there, typically http://localhost:8888/notebooks/cv_01_loading_and_displaying.ipynb (Links to an external site.)
Note that if you start more notebooks the port (default 8888) will be different for newer instances.

